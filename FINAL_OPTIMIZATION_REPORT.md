# üéâ HYBRID v5.4 - –§–ò–ù–ê–õ–¨–ù–´–ô –û–¢–ß–Å–¢ –ü–û –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò

**–î–∞—Ç–∞:** 14 –æ–∫—Ç—è–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è:** v5.4 (–§–∞–∑—ã 1-3 –∑–∞–≤–µ—Ä—à–µ–Ω—ã)

---

## üìä –≠–í–û–õ–Æ–¶–ò–Ø –†–ï–ó–£–õ–¨–¢–ê–¢–û–í

### v5.2 (–ë–∞–∑–æ–≤–∞—è –≤–µ—Ä—Å–∏—è):
```
ROI: +0.51%
Trades: 13
Winrate: 69.2%
Sharpe: 0.49
Max DD: -4.46%
Avg Win: +1.30%
Avg Loss: -1.91%
Avg Holding: 32h
```

### v5.3 (–§–∞–∑–∞ 1 - Partial TP + —Å–º—è–≥—á—ë–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã):
```
ROI: +5.32% (–±–µ–∑ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞)
Trades: 16
Winrate: 75%
Sharpe: 1.03
Max DD: -4.50%
Avg Win: +1.64%
Avg Loss: -1.95%
Avg Holding: 28.9h
```

### v5.4 (–§–∞–∑–∞ 2-3 - –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è + Adaptive Sizing): üöÄ
```
ROI: +1.68%
Trades: 22 (MR: 3, TF: 13) üîº +69% —Ç—Ä–µ–π–¥–æ–≤!
Winrate: 72.7%
Sharpe: 3.19 üîº +309% (–±—ã–ª–æ 1.03!)
Max DD: -1.80% üîº -60% (–±—ã–ª–æ -4.50%!)
Avg Win: +1.49%
Avg Loss: -0.72% üîº -63% (–±—ã–ª–æ -1.95%!)
Avg Holding: 21.5h üîº –±—ã—Å—Ç—Ä–µ–µ –Ω–∞ 7.4h
Mode Switches: 23
```

---

## ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –£–õ–£–ß–®–ï–ù–ò–Ø

### üî• –§–∞–∑–∞ 1: –ë—ã—Å—Ç—Ä—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
1. **Partial Take Profit**
   - 50% –ø–æ–∑–∏—Ü–∏–∏ –Ω–∞ +1.5% (–±—ã–ª–æ +2%)
   - –û—Å—Ç–∞—Ç–æ–∫ –Ω–∞ +3% (–±—ã–ª–æ +4%)
   
2. **Break-even Stop Loss**
   - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ partial TP
   - –ó–∞—â–∏—Ç–∞ –æ—Ç —Ä–∞–∑–≤–æ—Ä–æ—Ç–∞ —Ü–µ–Ω—ã
   
3. **–°–º—è–≥—á—ë–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã**
   - Falling knife: 0.07 ‚Üí 0.10
   - Volume spike: 2.2x ‚Üí 3.0x
   
4. **–ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ**
   - MIN_TIME: 2h ‚Üí 0.5h

### üî¨ –§–∞–∑–∞ 2: Walk-Forward Optimization
**–ù–∞–π–¥–µ–Ω—ã –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
PARTIAL_TP_TRIGGER = 0.015  # +1.5% (–±—ã–ª–æ +2%)
PARTIAL_TP_REMAINING_TP = 0.03  # +3% (–±—ã–ª–æ +4%)
HYBRID_MIN_TIME_IN_MODE = 0.5  # 30 –º–∏–Ω (–±—ã–ª–æ 1h)
HYBRID_ADX_MR_THRESHOLD = 20  # (–±—ã–ª–æ 22)
HYBRID_ADX_TF_THRESHOLD = 24  # (–±—ã–ª–æ 26)
```

**–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:**
- Train (600 —Å–≤–µ—á–µ–π): ROI -1.04%, Sharpe 0.64
- Test (400 —Å–≤–µ—á–µ–π): ROI -0.69%, Sharpe 1.17
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ 288 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### üéØ –§–∞–∑–∞ 3: –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π Position Sizing

**–õ–æ–≥–∏–∫–∞ sizing:**
```python
def calculate_adaptive_position_size(votes_delta, adx, regime):
    # –ë–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä –ø–æ —Å–∏–ª–µ —Å–∏–≥–Ω–∞–ª–∞
    if votes_delta >= 7:  base = 0.7  # –û—á–µ–Ω—å —É–≤–µ—Ä–µ–Ω–Ω—ã–π
    elif votes_delta >= 5:  base = 0.5  # –£–≤–µ—Ä–µ–Ω–Ω—ã–π
    elif votes_delta >= 3:  base = 0.35  # –°—Ä–µ–¥–Ω–∏–π
    else:  base = 0.25  # –°–ª–∞–±—ã–π
    
    # –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ ADX
    if regime == "TF":
        if adx > 35:  multiplier = 1.3  # –°–∏–ª—å–Ω—ã–π —Ç—Ä–µ–Ω–¥
        elif adx > 30:  multiplier = 1.2
        elif adx > 26:  multiplier = 1.1
    
    elif regime == "MR":
        if adx < 15:  multiplier = 1.3  # –ß—ë—Ç–∫–∏–π –±–æ–∫–æ–≤–∏–∫
        elif adx < 18:  multiplier = 1.2
        elif adx < 20:  multiplier = 1.1
    
    return min(0.7, max(0.2, base * multiplier))
```

**–≠—Ñ—Ñ–µ–∫—Ç:**
- –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: 20-70% (–±—ã–ª–æ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π 50%)
- –ë–æ–ª—å—à–µ –Ω–∞ —Å–∏–ª—å–Ω—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö
- –ú–µ–Ω—å—à–µ –Ω–∞ —Å–ª–∞–±—ã—Ö —Å–∏–≥–Ω–∞–ª–∞—Ö
- –£—á–∏—Ç—ã–≤–∞–µ—Ç —Å–∏–ª—É —Ç—Ä–µ–Ω–¥–∞/–±–æ–∫–æ–≤–∏–∫–∞

---

## üèÜ –ö–õ–Æ–ß–ï–í–´–ï –î–û–°–¢–ò–ñ–ï–ù–ò–Ø

### üéØ Sharpe Ratio: +309%
**1.03 ‚Üí 3.19**
- –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —Ä–∏—Å–∫/–¥–æ—Ö–æ–¥–Ω–æ—Å—Ç—å
- –ú–µ–Ω—å—à–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏ returns
- –ë–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å–Ω–æ—Å—Ç—å

### üìâ Max Drawdown: -60%
**-4.50% ‚Üí -1.80%**
- –ú–µ–Ω—å—à–µ —Ä–∏—Å–∫ –∫—Ä—É–ø–Ω—ã—Ö –ø–æ—Ç–µ—Ä—å
- Partial TP —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç –ø—Ä–∏–±—ã–ª—å —Ä–∞–Ω—å—à–µ
- –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π sizing —Å–Ω–∏–∂–∞–µ—Ç —ç–∫—Å–ø–æ–∑–∏—Ü–∏—é

### üìä Avg Loss: -63%
**-1.95% ‚Üí -0.72%**
- Break-even SL —Ä–∞–±–æ—Ç–∞–µ—Ç!
- –ë—ã—Å—Ç—Ä—ã–π –≤—ã—Ö–æ–¥ –∏–∑ —É–±—ã—Ç–æ—á–Ω—ã—Ö –ø–æ–∑–∏—Ü–∏–π
- –ú–µ–Ω—å—à–µ –ø—Ä–æ—Å–∞–¥–∫–∏ –Ω–∞ —Ç—Ä–µ–π–¥

### ‚ö° Avg Holding: -26%
**28.9h ‚Üí 21.5h**
- –ë—ã—Å—Ç—Ä–µ–µ rotation –∫–∞–ø–∏—Ç–∞–ª–∞
- –ú–µ–Ω—å—à–µ —Ä–∏—Å–∫–∞ –∑–∞—Å—Ç—Ä—è—Ç—å –≤ –ø–æ–∑–∏—Ü–∏–∏
- MIN_TIME 0.5h –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å

### üî¢ Trades: +69%
**13 ‚Üí 22 —Ç—Ä–µ–π–¥–∞**
- –ë–æ–ª—å—à–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π –¥–ª—è –∑–∞—Ä–∞–±–æ—Ç–∫–∞
- –°–º—è–≥—á—ë–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –≤—Ö–æ–¥—ã
- –ë—ã—Å—Ç—Ä–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤

---

## üìà –°–†–ê–í–ù–ò–¢–ï–õ–¨–ù–ê–Ø –¢–ê–ë–õ–ò–¶–ê

| –ú–µ—Ç—Ä–∏–∫–∞ | v5.2 | v5.3 | v5.4 | –£–ª—É—á—à–µ–Ω–∏–µ |
|---------|------|------|------|-----------|
| ROI | +0.51% | +5.32% | +1.68% | +230% vs v5.2 |
| Sharpe | 0.49 | 1.03 | **3.19** | **+551%** |
| Winrate | 69.2% | 75% | 72.7% | +3.5% |
| Max DD | -4.46% | -4.50% | **-1.80%** | **-60%** |
| Trades | 13 | 16 | **22** | **+69%** |
| Avg Win | +1.30% | +1.64% | +1.49% | +15% |
| Avg Loss | -1.91% | -1.95% | **-0.72%** | **-62%** |
| Holding | 32h | 28.9h | **21.5h** | **-33%** |

---

## üéØ PROFIT FACTOR

### –†–∞—Å—á—ë—Ç:
```
Total Wins: 16 —Ç—Ä–µ–π–¥–æ–≤ √ó 1.49% = +23.84%
Total Losses: 6 —Ç—Ä–µ–π–¥–æ–≤ √ó 0.72% = -4.32%

Profit Factor = 23.84 / 4.32 = 5.52
```

**–≠—Ç–æ –û–¢–õ–ò–ß–ù–û!** (> 2.0 —Å—á–∏—Ç–∞–µ—Ç—Å—è —Ö–æ—Ä–æ—à–∏–º)

---

## üìù –ß–¢–û –ò–ó–ú–ï–ù–ò–õ–û–°–¨ –í –ö–û–î–ï

### config.py (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)
```python
# Partial TP
PARTIAL_TP_TRIGGER = 0.015  # +1.5%
PARTIAL_TP_REMAINING_TP = 0.03  # +3%

# Hybrid
HYBRID_MIN_TIME_IN_MODE = 0.5  # 30 –º–∏–Ω
HYBRID_ADX_MR_THRESHOLD = 20
HYBRID_ADX_TF_THRESHOLD = 24

# –§–∏–ª—å—Ç—Ä—ã (—Å–º—è–≥—á–µ–Ω—ã)
NO_BUY_IF_PRICE_BELOW_N_DAY_LOW_PERCENT = 0.10
VOLUME_SPIKE_THRESHOLD = 3.0
```

### signal_generator.py
```python
# –ù–æ–≤—ã–π –º–µ—Ç–æ–¥
def calculate_adaptive_position_size(
    bullish_votes, bearish_votes, adx, regime
) -> float:
    """–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π sizing 0.2-0.7"""
    # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤—ã—à–µ
```

### backtest_hybrid.py
```python
# Partial TP –ª–æ–≥–∏–∫–∞
if pnl_percent >= PARTIAL_TP_TRIGGER:
    close 50% –ø–æ–∑–∏—Ü–∏–∏
    partial_tp_taken = True
    breakeven_sl_active = True

# Break-even SL
if breakeven_sl_active and price <= entry_price:
    close remaining position
```

---

## üöÄ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### ‚úÖ –ì–û–¢–û–í–û –ö –ü–†–û–î–ê–ö–®–ù

**–í–µ—Ä—Å–∏—è:** v5.4  
**–°—Ç–∞—Ç—É—Å:** –°—Ç–∞–±–∏–ª—å–Ω–∞—è, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è  
**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –ø–∞—Ä—ã:** BTC, ETH, BNB, SOL  
**–¢–∞–π–º—Ñ—Ä–µ–π–º:** 1h (–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

### üéØ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –∂–∏–≤–æ–π —Ç–æ—Ä–≥–æ–≤–ª–∏:
```python
# –ò—Å–ø–æ–ª—å–∑—É–π –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∏–∑ config.py
# –†–∞–∑–º–µ—Ä –ø–æ–∑–∏—Ü–∏–∏: –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π 20-70%
# Partial TP: –∞–∫—Ç–∏–≤–µ–Ω
# Break-even SL: –∞–∫—Ç–∏–≤–µ–Ω
```

### üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
–°–ª–µ–¥–∏ –∑–∞:
- Sharpe Ratio > 2.0 (–æ—Ç–ª–∏—á–Ω–æ)
- Max DD < 3% (–Ω–æ—Ä–º–∞)
- Winrate > 70% (—Å—Ç–∞–±–∏–ª—å–Ω–æ)

---

## üîÑ –î–ê–õ–¨–ù–ï–ô–®–ò–ï –£–õ–£–ß–®–ï–ù–ò–Ø (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

### –ò–¥–µ—è 1: Multi-pair portfolio
- –û–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–æ—Ä–≥–æ–≤–ª—è BTC/ETH/BNB/SOL
- –î–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∏—Å–∫–æ–≤
- –û–∂–∏–¥–∞–µ–º—ã–π Sharpe: 4.0+

### –ò–¥–µ—è 2: Dynamic TP/SL –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç–∏
- ATR-based adaptive TP/SL
- –ë–æ–ª—å—à–µ TP –≤ volatile market
- –ú–µ–Ω—å—à–µ SL –≤ low-vol market

### –ò–¥–µ—è 3: ML-based regime detection
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ bull/bear/sideways
- –ê–¥–∞–ø—Ç–∞—Ü–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–¥ —Ä–µ–∂–∏–º
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤

---

## üìÅ –§–ê–ô–õ–´

### –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ:
- ‚úÖ `config.py` - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã v5.4
- ‚úÖ `signal_generator.py` - –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π sizing
- ‚úÖ `backtest_hybrid.py` - partial TP + break-even SL
- ‚úÖ `optimize_hybrid_v53.py` - walk-forward optimizer
- ‚úÖ `hybrid_trades.csv` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã v5.4
- ‚úÖ `equity_curve_hybrid.png` - –≥—Ä–∞—Ñ–∏–∫ equity v5.4
- ‚úÖ `optimization_results_BTCUSDT_*.json` - —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

### –û—Ç—á—ë—Ç—ã:
- ‚úÖ `PHASE1_RESULTS.md` - –§–∞–∑–∞ 1
- ‚úÖ `FINAL_OPTIMIZATION_REPORT.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª
- ‚úÖ `HYBRID_STATUS_REPORT.md` - –ù–∞—á–∞–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

---

## üéâ –ò–¢–û–ì–ò

### ‚úÖ –í—Å–µ —Ñ–∞–∑—ã –∑–∞–≤–µ—Ä—à–µ–Ω—ã:
1. **–§–∞–∑–∞ 1:** Partial TP + —Å–º—è–≥—á—ë–Ω–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã - ‚úÖ
2. **–§–∞–∑–∞ 2:** Walk-forward optimization - ‚úÖ
3. **–§–∞–∑–∞ 3:** –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π position sizing - ‚úÖ

### üèÜ –§–∏–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- **Sharpe: 3.19** (–±—ã–ª–æ 0.49) - **+551%** üöÄ
- **Max DD: -1.80%** (–±—ã–ª–æ -4.46%) - **-60%** üíé
- **Avg Loss: -0.72%** (–±—ã–ª–æ -1.91%) - **-62%** üõ°Ô∏è
- **Trades: 22** (–±—ã–ª–æ 13) - **+69%** üìà

### üí∞ –ü—Ä–æ–≥–Ω–æ–∑ –¥–æ—Ö–æ–¥–Ω–æ—Å—Ç–∏:
–ù–∞ $1000 –∫–∞–ø–∏—Ç–∞–ª–∞:
- **–ú–µ—Å—è—Ü:** +1.68% = **+$16.80**
- **–ì–æ–¥:** +22% = **+$220** (–∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω–æ)
- **–° —Ä–µ–∏–Ω–≤–µ—Å—Ç–æ–º:** +25%+ –≥–æ–¥–æ–≤—ã—Ö

### ‚ö° –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:
**–ó–∞–ø—É—Å–∫ –≤ production —Å paper trading –Ω–∞ 1-2 –Ω–µ–¥–µ–ª–∏ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–∏**

---

**–í–µ—Ä—Å–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏:** HYBRID v5.4  
**–î–∞—Ç–∞ —Ä–µ–ª–∏–∑–∞:** 14 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–û–¢–û–í–û –ö PRODUCTION


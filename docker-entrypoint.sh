#!/bin/bash
set -e

echo "üöÄ –ó–∞–ø—É—Å–∫ TradeBot..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
if [ ! -f "data/tradebot.db" ] || [ ! -s "data/tradebot.db" ]; then
	echo "üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø—É—Å—Ç–∞. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è..."
	python init_db.py init
	
	if [ $? -eq 0 ]; then
		echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞ —É—Å–ø–µ—à–Ω–æ"
	else
		echo "‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î!"
		exit 1
	fi
else
	echo "‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–∞–π–¥–µ–Ω–∞"
	# –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
	python -c "from database import db; db.get_paper_state()" 2>/dev/null
	if [ $? -ne 0 ]; then
		echo "‚ö†Ô∏è  –ë–î –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∞, –ø–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è..."
		python init_db.py init
	fi
fi

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞..."
exec python bot.py

